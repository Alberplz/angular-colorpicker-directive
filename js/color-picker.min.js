"use strict";var colorPicker=angular.module("colorpicker",[]).factory("ColorHelper",function(){return{hsla2hsva:function(a){var b=Math.min(a.h,1),c=Math.min(a.s,1),d=Math.min(a.l,1),e=Math.min(a.a,1);if(0===d)return{h:b,s:0,v:0,a:e};var f=d+c*(1-Math.abs(2*d-1))/2;return{h:b,s:2*(f-d)/f,v:f,a:e}},hsva2hsla:function(a){var b=a.h,c=a.s,d=a.v,e=a.a;if(0===d)return{h:b,s:0,l:0,a:e};if(0===c&&1===d)return{h:b,s:1,l:1,a:e};var f=d*(2-c)/2;return{h:b,s:d*c/(1-Math.abs(2*f-1)),l:f,a:e}},rgbaToHsva:function(a){var h,i,b=Math.min(a.r,1),c=Math.min(a.g,1),d=Math.min(a.b,1),e=Math.min(a.a,1),f=Math.max(b,c,d),g=Math.min(b,c,d),j=f,k=f-g;if(i=0===f?0:k/f,f===g)h=0;else{switch(f){case b:h=(c-d)/k+(d>c?6:0);break;case c:h=(d-b)/k+2;break;case d:h=(b-c)/k+4}h/=6}return{h:h,s:i,v:j,a:e}},hsvaToRgba:function(a){var f,g,h,b=a.h,c=a.s,d=a.v,e=a.a,i=Math.floor(6*b),j=6*b-i,k=d*(1-c),l=d*(1-j*c),m=d*(1-(1-j)*c);switch(i%6){case 0:f=d,g=m,h=k;break;case 1:f=l,g=d,h=k;break;case 2:f=k,g=d,h=m;break;case 3:f=k,g=l,h=d;break;case 4:f=m,g=k,h=d;break;case 5:f=d,g=k,h=l}return{r:f,g:g,b:h,a:e}},stringToHsva:function(a){var b=[{re:/(rgb)a?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*%?,\s*(\d{1,3})\s*%?(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return["rgb",parseInt(a[2]),parseInt(a[3]),parseInt(a[4]),isNaN(parseFloat(a[5]))?1:parseFloat(a[5])]}},{re:/(hsl)a?\(\s*(\d{1,3})\s*,\s*(\d{1,3})%\s*,\s*(\d{1,3})%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return["hsl",parseInt(a[2]),parseInt(a[3]),parseInt(a[4]),isNaN(parseFloat(a[5]))?1:parseFloat(a[5])]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/,parse:function(a){return["hex",parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),1]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/,parse:function(a){return["hex",parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16),1]}}];a=a.toLowerCase();var c=null;for(var d in b)if(b.hasOwnProperty(d)){var e=b[d],f=e.re.exec(a),g=f&&e.parse(f);if(g)return c="hex"===g[0]||"rgb"===g[0]?this.rgbaToHsva({r:g[1]/255,g:g[2]/255,b:g[3]/255,a:g[4]}):this.hsla2hsva({h:g[1]/360,s:g[2]/100,l:g[3]/100,a:g[4]})}return c}}});colorPicker.directive("colorPicker",["$document","$compile","ColorHelper",function(a,b,c){return{restrict:"A",scope:{colorPickerModel:"=",colorPickerOutputFormat:"="},controller:["$scope",function(a){function b(a){return{r:Math.round(255*a.r),g:Math.round(255*a.g),b:Math.round(255*a.b),a:a.a}}a.show=!1,a.sAndLMax={},a.hueMax={},a.alphaMax={},a.type=0,a.hsva={h:.5,s:1,v:1,a:1},a.hueSlider={left:0},a.sAndLSlider={left:0,top:0},a.alphaSlider={left:0},a.rbgaSteps={r:1,g:1,b:1,a:.1},a.hslaSteps={h:1,s:1,l:1,a:.1},a.cancelButtonClass="",a.showCancelButton=!1,a.extraLargeClass="","rgba"===a.colorPickerOutputFormat?a.type=1:"hsla"===a.colorPickerOutputFormat&&(a.type=2),a.setSaturation=function(b,d){var e=c.hsva2hsla(a.hsva);e.s=b/d,a.hsva=c.hsla2hsva(e)},a.setLightness=function(b,d){var e=c.hsva2hsla(a.hsva);e.l=b/d,a.hsva=c.hsla2hsva(e)},a.setHue=function(b,c){a.hsva.h=b/c},a.setAlpha=function(b,c){a.hsva.a=b/c},a.setR=function(b,d){var e=c.hsvaToRgba(a.hsva);e.r=b/d,a.hsva=c.rgbaToHsva(e)},a.setG=function(b,d){var e=c.hsvaToRgba(a.hsva);e.g=b/d,a.hsva=c.rgbaToHsva(e)},a.setB=function(b,d){var e=c.hsvaToRgba(a.hsva);e.b=b/d,a.hsva=c.rgbaToHsva(e)},a.setSaturationAndBrightness=function(b,c,d,e){a.hsva.s=b/d,a.hsva.v=c/e},a.update=function(){var d=c.hsva2hsla(a.hsva);a.hslaText={h:Math.round(360*d.h),s:Math.round(100*d.s),l:Math.round(100*d.l),a:Math.round(100*d.a)/100};var e=b(c.hsvaToRgba(a.hsva)),f=b(c.hsvaToRgba({h:a.hsva.h,s:1,v:1,a:1}));if(a.rgbaText={r:e.r,g:e.g,b:e.b,a:Math.round(100*e.a)/100},a.hexText="#"+(1<<24|parseInt(e.r,10)<<16|parseInt(e.g,10)<<8|parseInt(e.b,10)).toString(16).substr(1),a.hexText[1]===a.hexText[2]&&a.hexText[3]===a.hexText[4]&&a.hexText[5]===a.hexText[6]&&(a.hexText="#"+a.hexText[1]+a.hexText[3]+a.hexText[5]),a.alphaSliderColor="rgb("+e.r+","+e.g+","+e.b+")",a.hueSliderColor="rgb("+f.r+","+f.g+","+f.b+")",0===a.type&&a.hsva.a<1&&a.type++,a.hsva.a<1)switch(a.colorPickerOutputFormat){case"hsla":a.outputColor="hsla("+a.hslaText.h+","+a.hslaText.s+"%,"+a.hslaText.l+"%,"+a.hslaText.a+")";break;default:a.outputColor="rgba("+e.r+","+e.g+","+e.b+","+Math.round(100*e.a)/100+")"}else switch(a.colorPickerOutputFormat){case"hsla":a.outputColor="hsl("+a.hslaText.h+","+a.hslaText.s+"%,"+a.hslaText.l+"%)";break;case"rgba":a.outputColor=a.alphaSliderColor;break;default:a.outputColor=a.hexText}a.sAndLSlider={left:a.hsva.s*a.sAndLMax.x-8+"px",top:(1-a.hsva.v)*a.sAndLMax.y-8+"px"},a.hueSlider.left=a.hsva.h*a.hueMax.x-8+"px",a.alphaSlider.left=a.hsva.a*a.alphaMax.x-8+"px",a.alphaInvalidClass=""},a.setColorFromHex=function(b){var d=c.stringToHsva(b);return null!==d&&(a.hsva=d),d},a.typePolicy=function(){return a.type=(a.type+1)%3,0===a.type&&a.hsva.a<1&&a.type++,a.type}}],link:function(d,e,f){function k(a){var b=c.stringToHsva(a);null!==b&&(d.hsva=b,d.update())}function l(){setTimeout(function(){m()},5)}function m(){d.$apply(function(){f.colorPickerShowValue="true",k(e.val()),d.colorPickerModel=e.val()})}function n(b){i=d.colorPickerModel,d.$apply(function(){d.show=!0}),d.$apply(function(){var a=g[0].getElementsByClassName("saturation-lightness")[0];d.sAndLMax={x:a.offsetWidth||230,y:a.offsetHeight||130},d.hueMax={x:g[0].getElementsByClassName("hue")[0].offsetWidth||150},d.alphaMax={x:g[0].getElementsByClassName("alpha")[0].offsetWidth||150},d.update()}),p(),a.on("mousedown",q),angular.element(window).on("resize",o)}function o(){p()}function p(){var a;"true"===f.colorPickerFixedPosition?(a=s(e[0],!1),g[0].style.position="fixed"):a=s(e[0],!0),"left"===f.colorPickerPosition?(g[0].style.top=a.top+"px",g[0].style.left=a.left-252+"px"):"top"===f.colorPickerPosition?(g[0].style.top=a.top-a.height-284+"px",g[0].style.left=a.left+"px"):"bottom"===f.colorPickerPosition?(g[0].style.top=a.top+a.height+10+"px",g[0].style.left=a.left+"px"):(g[0].style.top=a.top+"px",g[0].style.left=a.left+a.width+"px")}function q(b){b.target===e[0]||g[0]===b.target||r(g[0],b.target)||(d.$apply(function(){d.show=!1}),a.off("mousedown",q),angular.element(window).off("resize",o))}function r(a,b){for(var c=b.parentNode;null!==c;){if(c===a)return!0;c=c.parentNode}return!1}function s(a,b){return{top:a.getBoundingClientRect().top+(b?window.pageYOffset:0),left:a.getBoundingClientRect().left+(b?window.pageXOffset:0),width:a.offsetWidth,height:a.offsetHeight}}var g,i="";if(void 0===d.colorPickerModel&&(d.colorPickerModel="#008fff",e.val("")),void 0===f.colorPickerShowValue&&(f.colorPickerShowValue="true"),void 0===f.colorPickerPosition&&(f.colorPickerPosition="right"),void 0===f.colorPickerShowInputSpinner&&(f.colorPickerShowInputSpinner="false"),void 0===f.colorPickerShowCancelButton&&(f.colorPickerShowCancelButton="false"),"true"===f.colorPickerShowCancelButton&&(d.showCancelButton=!0,d.extraLargeClass="color-picker-extra-large"),void 0!==f.colorPickerCancelButtonClass&&(d.cancelButtonClass=f.colorPickerCancelButtonClass),void 0!==f.colorPickerSpinnerRgbaSteps&&null!==f.colorPickerSpinnerRgbaSteps.match(/^\d+;\d+;\d+;[0-9]+([\.][0-9]{1,2})?$/)){var j=f.colorPickerSpinnerRgbaSteps.split(";");d.rbgaSteps={r:j[0],g:j[1],b:j[2],a:j[3]}}if(void 0!==f.colorPickerSpinnerHslaSteps&&null!==f.colorPickerSpinnerHslaSteps.match(/^\d+;\d+;\d+;[0-9]+([\.][0-9]{1,2})?$/)){var j=f.colorPickerSpinnerHslaSteps.split(";");d.hslaSteps={h:j[0],s:j[1],l:j[2],a:j[3]}}k(d.colorPickerModel),"true"===f.colorPickerShowValue&&e.val(d.outputColor),g=angular.element('<div ng-show="show" class="color-picker ng-hide {{extraLargeClass}}">   <div class="arrow arrow-'+f.colorPickerPosition+'"></div>   <div slider rg-x=1 rg-y=1 action="setSaturationAndBrightness(s, v, rgX, rgY)" class="saturation-lightness" ng-style="{\'background-color\':hueSliderColor}">       <div class="cursor-sv" ng-style="{\'top\':sAndLSlider.top, \'left\':sAndLSlider.left}"></div>   </div>   <div slider rg-x=1 action="setHue(v, rg)" class="hue">       <div class="cursor" ng-style="{\'left\':hueSlider.left}"></div>   </div>   <div slider rg-x=1 action="setAlpha(v, rg)" class="alpha" ng-style="{\'background-color\':alphaSliderColor}">       <div class="cursor" ng-style="{\'left\':alphaSlider.left}"></div>   </div>   <div class="selected-color-background"></div>   <div class="selected-color" ng-style="{\'background-color\':outputColor}"></div>   <div ng-show="type==2" class="hsla-text">       <input text type="number" pattern="[0-9]*" min="0" max="360" step="'+d.hslaSteps.h+'" rg=360 action="setHue(v, rg)" ng-model="hslaText.h" spinner="'+f.colorPickerShowInputSpinner+'" />       <input text type="number" pattern="[0-9]*" min="0" max="100" step="'+d.hslaSteps.s+'" rg=100 action="setSaturation(v, rg)" ng-model="hslaText.s" spinner="'+f.colorPickerShowInputSpinner+'" />       <input text type="number" pattern="[0-9]*" min="0" max="100" step="'+d.hslaSteps.l+'" rg=100 action="setLightness(v, rg)" ng-model="hslaText.l" spinner="'+f.colorPickerShowInputSpinner+'" />       <input text type="number" pattern="[0-9]+([.,][0-9]{1,2})?" min="0" max="1" step="'+d.hslaSteps.a+'" rg=1 action="setAlpha(v, rg)" ng-model="hslaText.a" spinner="'+f.colorPickerShowInputSpinner+'" />       <div>H</div><div>S</div><div>L</div><div>A</div>   </div>   <div ng-show="type==1" class="rgba-text">       <input text type="number" pattern="[0-9]*" min="0" max="255" step="'+d.rbgaSteps.r+'" rg=255 action="setR(v, rg)" ng-model="rgbaText.r" spinner="'+f.colorPickerShowInputSpinner+'" />       <input text type="number" pattern="[0-9]*" min="0" max="255" step="'+d.rbgaSteps.g+'" rg=255 action="setG(v, rg)" ng-model="rgbaText.g" spinner="'+f.colorPickerShowInputSpinner+'" />       <input text type="number" pattern="[0-9]*" min="0" max="255" step="'+d.rbgaSteps.b+'" rg=255 action="setB(v, rg)" ng-model="rgbaText.b" spinner="'+f.colorPickerShowInputSpinner+'" />       <input text type="number" pattern="[0-9]+([.,][0-9]{1,2})?" min="0" max="1" step="'+d.rbgaSteps.a+'" rg=1 action="setAlpha(v, rg)" ng-model="rgbaText.a" spinner="'+f.colorPickerShowInputSpinner+'" />       <div>R</div><div>G</div><div>B</div><div>A</div>   </div>   <div class="hex-text" ng-show="type==0">       <input text type="text" action="setColorFromHex(string)" ng-model="hexText"/>       <div>HEX</div>   </div>   <div ng-click="typePolicy()" class="type-policy"></div>   <button type="button" class="{{cancelButtonClass}}" ng-show="showCancelButton" ng-click="cancelColor()">Cancel</button></div>'),document.getElementsByTagName("body")[0].appendChild(g[0]),b(g)(d),e.on("paste",l),e.on("keyup",m),d.$on("color-changed",function(a){d.$apply(function(){d.update(),d.colorPickerModel=d.outputColor,"true"===f.colorPickerShowValue&&e.val(d.outputColor)})}),d.cancelColor=function(){d.colorPickerModel=i,d.show=!1,k(d.colorPickerModel),a.off("mousedown",q),angular.element(window).off("resize",o)},e.on("click",n),e.on("$destroy",function(){e.off("click",n),e.off("keyup",m),e.off("paste",l)})}}}]),colorPicker.directive("text",[function(){return{restrict:"A",scope:{action:"&"},link:function(a,b,c){function d(a){"true"===c.spinner&&b.removeClass("color-picker-input-spinner")}function e(a){b.addClass("color-picker-input-spinner")}function f(a){setTimeout(function(){g(a)},5)}function g(d){if(void 0===c.rg)a.action({string:b.val()})&&a.$emit("color-changed");else{var e=parseFloat(b.val());isNaN(e)?a.$emit("alpha-invalid"):(e=Math.abs(Math.min(parseFloat(b.val()),c.rg)),a.action({v:e,rg:c.rg}),a.$emit("color-changed"),a.$emit("alpha-valid"))}}b.on("paste",f),b.on("keyup",g),b.on("change",g),b.on("focus",d),b.on("blur",e),b.on("mouseover",d),b.on("mouseout",e),b.addClass("color-picker-input-spinner"),b.on("$destroy",function(){b.off("paste",f),b.off("keyup",g),b.off("change",g),b.off("focus",d),b.off("blur",e),b.off("mouseover",d),b.off("mouseout",e)})}}}]),colorPicker.directive("slider",["$document","$window",function(a,b){return{restrict:"A",scope:{action:"&"},link:function(c,d,e){function f(b){h(b),a.on("mousemove touchmove",g)}function g(a){a.preventDefault(),h(a)}function h(a){var b=d[0].offsetHeight,f=d[0].offsetWidth,g=Math.max(0,Math.min(i(a,d[0]),f)),h=Math.max(0,Math.min(j(a,d[0]),b));void 0!==e.rgX&&void 0!==e.rgY?c.action({s:g/f,v:1-h/b,rgX:e.rgX,rgY:e.rgY}):c.action({v:g/f,rg:e.rgX}),c.$emit("color-changed")}function i(a,c){return(void 0!==a.pageX?a.pageX:a.touches[0].pageX)-c.getBoundingClientRect().left-b.pageXOffset}function j(a,c){return(void 0!==a.pageY?a.pageY:a.touches[0].pageY)-c.getBoundingClientRect().top-b.pageYOffset}d.on("mousedown touchstart",f),a.on("mouseup touchend",function(){a.off("mousemove touchmove",g)}),d.on("$destroy",function(){d.off("mousedown touchend",f)})}}}]);
